const dropZone=document.getElementById("drop-zone"),input=document.getElementById("pdf-upload"),previewArea=document.getElementById("preview-area"),downloadAllBtn=document.getElementById("download-all"),loadingText=document.getElementById("loading");let imageDataList=[];dropZone.addEventListener("click",()=>input.click()),dropZone.addEventListener("dragenter",e=>{e.preventDefault(),dropZone.classList.add("bg-primary","bg-opacity-10")}),dropZone.addEventListener("dragleave",e=>{e.preventDefault(),dropZone.classList.remove("bg-primary","bg-opacity-10")}),dropZone.addEventListener("dragover",e=>{e.preventDefault()}),dropZone.addEventListener("drop",e=>{e.preventDefault(),dropZone.classList.remove("bg-primary","bg-opacity-10");const t=e.dataTransfer.files;t.length>0&&handleFile(t[0])}),input.addEventListener("change",e=>{e.target.files.length>0&&handleFile(e.target.files[0])});async function handleFile(e){if(!e||"application/pdf"!==e.type)return void alert("Please upload a valid PDF file.");loadingText.textContent="Processing PDF...",imageDataList=[],previewArea.innerHTML="",downloadAllBtn.classList.add("d-none");const t=new FileReader;t.onload=async function(){const t=new Uint8Array(this.result),a=await pdfjsLib.getDocument({data:t}).promise;for(let t=1;t<=a.numPages;t++){const r=await a.getPage(t),n=r.getViewport({scale:2}),d=document.createElement("canvas"),o=d.getContext("2d");d.height=n.height,d.width=n.width,await r.render({canvasContext:o,viewport:n}).promise;const l=d.toDataURL("image/jpg");imageDataList.push(l);const s=document.createElement("div");s.className="col",s.innerHTML=`<div class="card h-100 shadow-sm"><img src="${l}" alt="Page ${t}" class="card-img-top rounded" /><div class="card-body text-center"><a href="${l}" download="page-${t}.jpg" class="btn btn-danger">Download Page ${t}</a></div></div>`,previewArea.appendChild(s)}downloadAllBtn.classList.remove("d-none"),loadingText.textContent=""},t.readAsArrayBuffer(e)}downloadAllBtn.addEventListener("click",async()=>{const e=new JSZip;imageDataList.forEach((t,a)=>{e.file(`page-${a+1}.jpg`,t.split(",")[1],{base64:!0})});const t=await e.generateAsync({type:"blob"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download="pdf-images.zip",a.click()});
